# HW #1

- 파일에서 데이터 읽어들이는 코드 제공
- 이미지 반전 코드 제공
- Callback 함수
- HW1_Callback
	- 47 줄 : for문을 통해 다각형의 각 꼭짓점의 좌표를 받아온다.

#### GLM
> Affine 변환을 돕는 라이브러리

# HW #2

10 msec 있다가 timer라는 함수에 0 값을 집어넣어서 호출해달라
```cpp
void timer(int value) {
	timestamp = (timestamp + 1) % UINT_MAX;
	glutPostRedisplay();
	glutTimerFunc(10, timer, 0);
}
```
display call back에서 timerstamp 활용
자기 자신을 호출하여 주기적인 실행을 보장한다.

조직적으로 같이 움직이는 방법 (리깅)
계층적인 구조의 단순한 버전을 구현해놓음

# HW #3

glPolygonMode() 함수를 잘 기억하길 바람  
glDrawElement(): 삼각형을 그리기 위해 polygon attributes를 쑤셔넣는 것  
glDispatch_() 마찬가지  
glDrawArray()의 첫번째 인자는 Vertex shader에서 처리되어 나온 vertices를 어떤 모양으로 조립할지(삼각형, 선 등) 지정해준다.  

- Tiger__Wire_frame_GL_SI  
	- `v_color`: fragment shader의 input  
	- `final_color`: fragment shader의 output  
	- vertex shader: MC -> CC fragment shader와 다르게 vertex는 무조건 input output이 일대일 대응이다.  
  
`OpenGL_프로그래밍_보충자료_2.pdf` 참고  

걸어다니는 애를 컨트롤하기 어려우면 ben이라는 뛰어다니는 애를 움직여도 됨

# HW #4

1. 다음 Lighting Equation 
$$\begin{align}
c &= e_{cm} + a_{cm} \times a_{cs} + \\
& \sum\limits_{i=0}^{n-1}(att_i)(spot_i)[a_{cm} \times a_{cli} + (n \odot\overrightarrow{VP}_{pli})d_{cm} \times d_{cli} + (f_i)(n\odot\hat{h_i})^{s_{rm}}s_{cm} \times s_{cli}]
\end{align}$$

### 6.1 조명 모델의 역할

실제로 OpenGL 시스템에서 사용되는 Lighting Model에 대해서 구체적으로 알아보자.
  
다음은 lighting 조합 module을 OpenGL 함수와 관련지어 상세히 표시한 그림이다.  
![500](../../../../Z.%20Docs/img/Pasted%20image%2020240604162859.png)

먼저, 다음 OpenGL Pipeline을 복기하자.  
> `MC` -$M_M$-> `WC` -$M_V$-> `EC` -$M_P$-> `CC` -`원근 나눗셈 연산`> `NDC` -$M_{VP}$> `WdC

결정되는 색깔의 두 가지 인자는 다음과 같다.  
1. Primary Color(주 색깔)
2. Secondary Color(보조 색깔)

위 그림은 EC에서 사용될 색깔에 대한 계산 구조를 보여준다.  
여기서 색깔은 크게 두 가지 방법에 의해 결정된다. `그림의 (5)번 스위치 참고`  
1. Lighting Module
	- `glEnable(GL_LIGHTING);`으로 명시적으로 shading 계산을 수행한다고 지정해야한다. 원래대로 돌아가려면 `glDisable(CGL_LIGHTING);`을 하면 된다.
	- Phong's Lighting Model 같은 조명 모델을 사용한다.
	- Primary Color과 Secondary Color이 계산된다.
2. `glColor*(*)` 함수
	- Default 값이다.
	- 별다른 Shading 없이 위 함수를 통해 Current Color를 설정한다.
	- Primary Color = Current Color, Secondary Color = (0, 0, 0, 0)

### 6.2 라이팅 계산의 입력 인자

Lighting Model에 쓰이는 input data와 Lighting Prarmeter들에 대해서 살펴보자.  
그림을 참고하여 input data를 살펴보자.
- vertex in EC (2)
- normal in EC (3)
- Current Color and Material Parameters (4)
- Light Parameters and Light Model Prarmeters (9)
- `glFrontFace(*)` Parameter

이 인자들에 대해 다음과 같은 Lighting Equation을 사용하여 색깔 계산을 수행한다.  
이 Equation은 Phong Shading Equation과도 형태가 유사하니 잘 비교하며 살펴보자.  
$$\begin{align}
c &= e_{cm} + a_{cm} \times a_{cs} + \\
& \sum\limits_{i=0}^{n-1}(att_i)(spot_i)[a_{cm} \times a_{cli} + (n \odot\overrightarrow{VP}_{pli})d_{cm} \times d_{cli} + (f_i)(n\odot\hat{h_i})^{s_{rm}}s_cm \times s_{cli}]
\end{align}$$

#### 6.2.1 `void glFrontFace(GLenum mode)`

이제 어느정도 그래픽스 공부를 하였다면, 다면체 모델을 구성하고 있는 다각형은 일관된 방향성(Orientation), CW 또는 CCW가 필요하다는 것을 알고 있을 것이다.  
`GLenum mode`인자란 바로 이 CW 또는 CCW를 지정해주는 것이다. `GL_CW / GL_CCW`  

좌표계가 CCW이라는 가정 하에 Face에 대해서 설명을 해보겠다.
- Front Face: 물체를 밖에서 안으로 바라볼 때 보이는 면, CCW
- Back Face: 물체를 안에서 밖으로 바라볼 때 보이는 면, CW

단힌 물체의 경우 Front Face만 보이므로 Back Face에 불필요한 계산을 할 필요가 없는데, 이때 우리는 이 뒷면을 제거하는 것을 Backface Culling이라고 한다. (후술)

#### 6.2.2 Material Parameters (4)

Material Parameter
> 물체의 표면으로 들어온 빛이 어떻게 반사가 될 것인지 결정해주는 물질의 고유성질

우리는 이 값을 적절히 조절함으로써 물성을 나타낼 수 있다.  
어떻게 조절할지는 보통 실험적으로 결정하는 것 같다. 그래도 대략적으로 어떤 역할을 하는 색인지 알자.
- ambient color(엠비언트 색깔): 일반적으로 난반사 색깔과 동일하거나 조화를 이루도록
- diffuse color(난반사 색깔): 물체의 기본이 되는 색깔
- diifuse color - A 값: 불투명도
- specular color(정반사 색깔): 들어오는 빛을 어느 정도의 비율로 정반사 시킬 것인지

| Parameter |     Type     |        Default         |          Explanation           |
| :-------: | :----------: | :--------------------: | :----------------------------: |
| $a_{cm}$  |    $RGBA$    | $(0.2, 0.2, 0.2, 1.0)$ |         ambient color          |
| $d_{cm}$  |    $RGBA$    | $(0.8, 0.8, 0.8, 1.0)$ |         diffuse color          |
| $s_{cm}$  |    $RGBA$    | $(0.0, 0.0, 0.0, 1.0)$ |         specular color         |
| $e_{cm}$  |    $RGBA$    | $(0.0, 0.0, 0.0, 1.0)$ |        radiation color         |
| $s_{rm}$  | $\mathbb{R}$ |         $0.0$          | specular ratio, $[0.0, 128.0]$ |
여기서 처음 보는 parameter $e_{cm}$이 등장한다.  
이는 radiation color로, 물체가 스스로 빛을 발하는 성질과 관련된 인자이다. 

다음 Phong's Equation을 상기하자.
$$\begin{gather}
I_\lambda = I_{a\lambda} \cdot k_{a\lambda}+ \sum\limits_{i=0}^{m-1} f_{att}(d) \cdot I_{l\lambda} \cdot \{ k_{d\lambda} \cdot (N \circ L)+k_{s\lambda} \cdot (N \circ H)^n \} \\
(k_{a\lambda} = a_{cm},\ k_{d\lambda} = d_{cm},\ k_{s\lambda} = s_{cm},\ n = s_{rm})
\end{gather}$$

Material Parameter들은 다음과 같은 두 가지 방법을 통해 설정할 수 있다.  
1. `glMaterial*(*)`
```cpp
// v가 없음: 실제 변수, v가 있음: 포인터
// {i}: GLint(32-bit int) TYPE, {f}: GLfloat(32-bit float)
void glMaterial{if} (GLenum face GLenum pname, TYPE param); // only s_rm
void glMaterial{if}v (GLenum face GLenum pname, TYPE *param); // else

GLenum face = GL_FRONT, GL_BACK, GL_FRONT_AND_BACK;
GLenum pname = GL_AMBIENT, GL_DIFFUSE, GL_SPECULAR, GL_EMISSION,
				GL_SHININESS, GL_AMBIENT_AND_DIFFUSE
TYPE *param; // 실제로 설정할 값
```
  
실제 사용 예시는 다음과 같다.
```cpp
// 에메랄드처럼 보이게 하는 인자 설정 예시
GLfloat mat_ambient[4] = {0.03784, 0.30712, 0.03784, 1.0}; // 연두색과 조화를 이룸
GLfloat mat_diffuse[4] = {0.07568, 0.61424, 0.07568, 1.0}; // 연두색 계통
GLfloat mat_specular[4] = {0.633, 0.727811, 0.633, 1.0}; // 회색 계통
GLfloat mat_shininess = 22.0;
:
glMaterialfv(GL_FRONT, GL_AMBIENT, mat_ambient);
glMaterialfv(GL_FRONT, GL_DIFFUSE, mat_diffuse);
glMaterialfv(GL_FRONT, GL_SPECULAR, mat_speculat);
glMaterialf(GL_FRONT, GL_SHININESS, mat_shininess);
```
  
2. `glColorMaterial(*) & glColor*(*)`
상황에 따라서 물체의 색깔 인자 중 특정 색깔을 자주 바꾸어야 하는 경우가 있는데,  
이 때 이 두 번째 방법을 사용하면 더 빠르게 조명 계산을 할 수가 있다.
```cpp
void glColorMaterial(GLenum face, GLenum mode);
void glColor(TYPE *param);

GLenum mode = GL_AMBIENT, GL_DIFFUSE, GL_SPECULAR, GL_EMISSION,
				GL_AMBIENT_AND_DIFFUSE;
```

실제 사용 예시는 다음과 같다.
```cpp
glEnable(GL_COLOR_MATERIAL);  // 기능이 지금부터 필요함
glColorMaterial(GL_FLOAT, GL_DIFFUSE);  // 어느 face의 어느 parameter를 바꿀지 명시
for(int i = 65; i < 256; i++) {
	mat_diffuse[1] = i/255.0;
	glColor4fv(mat_diffuse);  // 실제 값 바꾸
	draw_scene();
}
glDisable(GL_COLOR_MATERIAL);  // 기능이 더 이상 필요 없음
```
대부분의 경우에, 어떤 물체의 색깔을 꼭지점 단위로 바꾸고 싶을 경우 2번 방법을 통해 바꾸는 것이 1번 방법보다 더 빠르게 수행이 될 가능성이 많다. `그렇지 않은 경우도 있다.`

#### 6.2.3 Light Parameters (9)

Light Parameter
> Ambient, diffuse, specular 반사에 영향을 미치는 광원의 성질

Phong's light module에서는 $I_{a\lambda}$(엠비언트 반사)와 $I_{l\lambda}$(난반사 및 정반사) 두 가지 광원 색깔 인자만 사용했지만, OpenGL 시스템에서는 이보다 좀 더 세밀하게 조절할 수 있다.  
- 세 가지 반사에 대해 광원의 색깔을 모두 다르게 한다던가,
- 앰비언트 반사에 대하여 모든 광원이 종합적으로 영향을 미치는 앰비언트 광원 색깔(global ambient reflection)과 각 광원이 물체에 직접적으로 영향을 미치는 앰비언트 광원의 색깔을 다르게 할 수 있다던가.

다음 Lighting Equation을 다시 상기해보자.
$$\begin{align}
c &= e_{cm} + a_{cm} \times a_{cs} + \\
& \sum\limits_{i=0}^{n-1}(att_i)(spot_i)[a_{cm} \times a_{cli} + (n \odot\overrightarrow{VP}_{pli})d_{cm} \times d_{cli} + (f_i)(n\odot\hat{h_i})^{s_{rm}}s_{cm} \times s_{cli}]
\end{align}$$
- $a_{cs}$(global ambient reflection): 장면 전체에 종합적으로 영향을 미치는 간접 조명 효과를 고려하기 위한 광원의 색깔
- $a_{cli}$(local ambient reflection): 엠비언트 반사에 대하여 직접적으로 영향을 미치는 $i$번째 광원의 색깔, 서로 다른 색깔 지정 가능
- $d_{cli}$: 난반사에 대하여 직접적으로 영향을 미치는 $i$번째 광원의 색깔, 필요할 경우 서로 다른 색깔 지정 가능
- $s_{cli}$: 정반사에 대하여 직접적으로 영향을 미치는 $i$번째 광원의 색깔, 필요할 경우 서로 다른 색깔 지정 가능

|               Parameter                |        Type        |                     Default                      |                 Explanation                  |
| :------------------------------------: | :----------------: | :----------------------------------------------: | :------------------------------------------: |
|               $a_{ali}$                |       $RGBA$       |              $(0.0, 0.0, 0.0, 1.0)$              |             $i$th ambient color              |
| $d_{cli} \ (i=0)$<br>$d_{cli} \ (i>0)$ |  $RGBA$<br>$RGBA$  | $(1.0, 1.0, 1.0, 1.0)$<br>$(0.0, 0.0, 0.0, 0.0)$ |  $0$th diffuse color<br>$i$th diffuse color  |
| $s_{cli} \ (i=0)$<br>$s_{cli} \ (i>0)$ |  $RGBA$<br>$RGBA$  | $(1.0, 1.0, 1.0, 1.0)$<br>$(0.0, 0.0, 0.0, 0.0)$ | $0$th specular color<br>$i$th specular color |
|               $P_{pli}$                | $\text{position}$  |              $(0.0, 0.0, 1.0, 0.0)$              |                $i$th position                |
|               $s_{dli}$                | $\text{direction}$ |                $(0.0, 0.0, -1.0)$                |          $i$th spot light direction          |
|               $s_{rli}$                |    $\mathbb{R}$    |                      $0.0$                       |    $i$th spot light ratio, $[0.0, 128.0]$    |
|               $c_{rli}$                |    $\mathbb{R}$    |                     $180.0$                      |         $i$th spot light clip angle          |
|                $k_{0i}$                |    $\mathbb{R}$    |                      $1.0$                       |      $i$th Constant attenuation factor       |
|                $k_{1i}$                |    $\mathbb{R}$    |                      $0.0$                       |       $i$th linear attenuation factor        |
|                $k_{2i}$                |    $\mathbb{R}$    |                      $0.0$                       |      $i$th quadratic attenuation factor      |
위의 표에서도 알 수 있든시, OpenGL에서는 관례상 0번부터 시작하여 0번 광원, 1번 광원... 처럼 광원의 이름을 붙인다.  
OpenGL 시스템을 구현하기 위해서 최소한 8개의 광원을 지원하여야 하고, 구현에 따라 그 이상을 지원할 수 있다.  

여기서 광원의 종류에 대해 상기하고 가자.
1. 점 광원(point light source)
	광원의 크기가 렌더링 하려는 전체 장면에 비하여 상대적으로 작을 경우에 사용한다.
	- 계산을 단순화 시키기 위하여 한 점 $(x, y, z)$에 광원이 있다고 가정한다.
	- 그림자가 뚜렷하게 질 것이다. `hard shadow`
	- `크기가 작은 전구, ..`
2. 평행 광원(parallel light source/directional light source)
	광원이 물체로부터 상당히 멀리 떨어져 있을 경우에 사용한다.
	- 계산을 단순화 시키기 위하여 모든 빛이 주어진 방향 $(x, y, z)$에 평행하게 들어온다고 가정한다.
	- `태양, ..`
3. 스폿 광원(spot light source)
	점 광원의 특수한 형태로 원뿔과 같이 일정한 범위로 빛을 발하는 광원이다.
	- 광원의 위치, 빛을 발하는 중심 방향과 범위의 설정이 필요하다.
	- `손 전등, 헤드라이트, 무대 조명, ..`

위 세가지 광원 중 점 광원과 평행 광원을 구분하는 방법은 다음과 같다.
- $P_{pli} = (x \ y\ z\ w)^t$
	$\begin{cases} w \neq 0,\ \text{point light at } (\frac{x}{w}, \frac{y}{w}, \frac{z}{w})^t \\ w = 0,\ \text{directional light to } (-x,\ -y,\ -z)^t\end{cases}$

Light Parameter들은 다음과 같은 방법을 통해 설정할 수 있다.
```cpp
void glLight{if}(GLenum light, GLenum pname, TYPE param);
void glLight{if}v(GLenum light, GLenum pname, TYPE *param);

GLenum light = GL_LIGHT1, GL_LIGHT2, GL_LIGHT3...;  // 보통 8개 까지
GLenum pname = GL_AMBIENT, GL_DIFFUSE, GL_SPECULAR, GL_POSITION;
GLenum param;  // 실제 변수 또는 포인터
```

실제 사용 예시는 다음과 같다.
```cpp
// 0번 광원 설정
GLfloat light_position[4] = {0.0, 5.0, 5.0, 1.0};  // 점 광원
GLfloat light_ambient_color[4] = {0.23, 0.23, 0.23, 1.0}; // 희미한 흰색
GLfloat light_diff_spec_color[4] = {0.95, 0.95, 0.95, 1.0}; // 아주 밝은 흰색
:
glLightfv(GL_LIGHT0, GL_POSITION, light_position);
glLightfv(GL_LIGHT0, GL_AMBIENT, light_ambient_color);
glLightfv(GL_LIGHT0, GL_DIFFUSE, light_diff_spec_color);
glLightfv(GL_LIGHT0, GL_SPECULAR, light_diff_spec_color);
```

이제 점 광원과 평행 광원의 설정 방법은 알 것 같다. 그럼 스폿 광원 효과는 어떨까?  
스폿 광원을 설정하려면 추가 인자 3개가 더 필요하다. 다음 그림을 보며 확인해보자.
![250](../../../../Z.%20Docs/img/Pasted%20image%2020240605214840.png)
- $s_{dli}$: 스폿 광원이 비추는 방향, $(x\ y\ z)^t$
- $s_{rli}$: 스폿 광원 지수로 밝기를 조절한다, $\mathbb{R}$
- $c_{rli}$: 스폿 광원의 절단 각도, $\mathbb{R},\ [0, 90.0]\ or\ 180.0\ (\text{default, spot light})$

그렇다면 스폿 광원에서 원래 빛의 인자 $a_{cli}$, $d_{cli}$, $s_{cli}$는 어떻게 다뤄질까?
이들은 스폿 광원이 비추는 방향인 $s_{dli}$로의 밝기가 된다.  
주변으로 갈 수록 어두워지는 것을 계산하기 위해선 몇 가지 요소가 더 필요하다. 정반사 공식을 상기하며 다음 식을 보자.
$$\cos^{s_{rli}}{\psi}$$
- $V$: 물체의 꼭지점의 위치
- $\psi$: $\angle{Vs_{dli}}$
여기서 어두워지는 정도에 스폿 광원 지수 $s_{rli}$가 쓰인다.

다음은 스폿 광원을 설정하는 예시이다.
```cpp
// 0번 광원 설정
GLfloat light_position[4] = {0.0, 5.0, 5.0, 1.0};
GLfloat spot_direction[3] = {1.0, 0.0, 1.0};  // s_dli
GLfloat light_ambient_color[4] = {0.23, 0.23, 0.23, 1.0}; // 희미한 흰색
GLfloat light_diff_spec_color[4] = {0.95, 0.95, 0.95, 1.0}; // 아주 밝은 흰색
:
glLightfv(GL_LIGHT0, GL_POSITION, light_position);
glLightfv(GL_LIGHT0, GL_AMBIENT, light_ambient_color);
glLightfv(GL_LIGHT0, GL_DIFFUSE, light_diff_spec_color);
glLightfv(GL_LIGHT0, GL_SPECULAR, light_diff_spec_color);
glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, spot_direction);
glLightf(GL_LIGHT0, GL_SPOT_EXPONENT, 3.0);  // s_rli
glLightf(GL_LIGHT0, GL_SPOT_CUTOFF, 30.0);  // c_rli
```

------------ cut line ------------

### 6.5 OpenGL의 조명 공식

$$\begin{align}
c &= e_{cm} + a_{cm} * a_{cs} + \\
& \sum\limits_{i=0}^{n-1}(att_i)(spot_i)[a_{cm} * a_{cli} + (n \odot\overrightarrow{VP}_{pli})d_{cm} * d_{cli} + (f_i)(n\odot\hat{h_i})^{s_{rm}}s_{cm} * s_{cli}]
\end{align}$$

**Meterial Parameter**

| Parameter |     Type     |        Default         |          Explanation           |
| :-------: | :----------: | :--------------------: | :----------------------------: |
| $a_{cm}$  |    $RGBA$    | $(0.2, 0.2, 0.2, 1.0)$ |         ambient color          |
| $d_{cm}$  |    $RGBA$    | $(0.8, 0.8, 0.8, 1.0)$ |         diffuse color          |
| $s_{cm}$  |    $RGBA$    | $(0.0, 0.0, 0.0, 1.0)$ |         specular color         |
| $e_{cm}$  |    $RGBA$    | $(0.0, 0.0, 0.0, 1.0)$ |        radiation color         |
| $s_{rm}$  | $\mathbb{R}$ |         $0.0$          | specular ratio, $[0.0, 128.0]$ |

**Light Parameter**

|               Parameter                |        Type        |                     Default                      |                 Explanation                  |
| :------------------------------------: | :----------------: | :----------------------------------------------: | :------------------------------------------: |
|               $a_{ali}$                |       $RGBA$       |              $(0.0, 0.0, 0.0, 1.0)$              |             $i$th ambient color              |
| $d_{cli} \ (i=0)$<br>$d_{cli} \ (i>0)$ |  $RGBA$<br>$RGBA$  | $(1.0, 1.0, 1.0, 1.0)$<br>$(0.0, 0.0, 0.0, 0.0)$ |  $0$th diffuse color<br>$i$th diffuse color  |
| $s_{cli} \ (i=0)$<br>$s_{cli} \ (i>0)$ |  $RGBA$<br>$RGBA$  | $(1.0, 1.0, 1.0, 1.0)$<br>$(0.0, 0.0, 0.0, 0.0)$ | $0$th specular color<br>$i$th specular color |
|               $P_{pli}$                | $\text{position}$  |              $(0.0, 0.0, 1.0, 0.0)$              |                $i$th position                |
|               $s_{dli}$                | $\text{direction}$ |                $(0.0, 0.0, -1.0)$                |          $i$th spot light direction          |
|               $s_{rli}$                |    $\mathbb{R}$    |                      $0.0$                       |    $i$th spot light ratio, $[0.0, 128.0]$    |
|               $c_{rli}$                |    $\mathbb{R}$    |                     $180.0$                      |         $i$th spot light clip angle          |
|                $k_{0i}$                |    $\mathbb{R}$    |                      $1.0$                       |      $i$th Constant attenuation factor       |
|                $k_{1i}$                |    $\mathbb{R}$    |                      $0.0$                       |       $i$th linear attenuation factor        |
|                $k_{2i}$                |    $\mathbb{R}$    |                      $0.0$                       |      $i$th quadratic attenuation factor      |
- $a_{cs}$(global ambient reflection): 장면 전체에 종합적으로 영향을 미치는 간접 조명 효과를 고려하기 위한 광원의 색깔
- $a_{cli}$(local ambient reflection): 엠비언트 반사에 대하여 직접적으로 영향을 미치는 $i$번째 광원의 색깔, 서로 다른 색깔 지정 가능
- $d_{cli}$: 난반사에 대하여 직접적으로 영향을 미치는 $i$번째 광원의 색깔, 필요할 경우 서로 다른 색깔 지정 가능
- $s_{cli}$: 정반사에 대하여 직접적으로 영향을 미치는 $i$번째 광원의 색깔, 필요할 경우 서로 다른 색깔 지정 가능

**Additional Parameter**
- $V$: 물체의 꼭지점의 위치
- $att_i$: 빛의 감쇠 효과를 위한 값
- $spot_i$: 스폿 광원일 경우를 위한 인자
- $f_i$: 빛이 들어오는 방향에 따른 정반사 값 채택 여부를 위한 인자
- $h_i$(halfway vector): 광원에 대한 방향과 관찰자 방향의 중간 방향으로의 단위 벡터
- $e_{cm}$: 물질의 방사 색깔

$$\begin{align}
a_{cm} * a_{cli} + (n \odot\overrightarrow{VP}_{pli})d_{cm} * d_{cli} + (f_i)(n\odot\hat{h_i})^{s_{rm}}s_{cm} * s_{cli} \\
= \text{ambient reflection} + \text{diffuse reflection} + \text{specular reflection}
\end{align}$$

2. diffuse reflection $(n \odot\overrightarrow{VP}_{pli})d_{cm} * d_{cli}$
- $P_{pli} = (x \ y\ z\ w)^t$:
	$\begin{cases} w \neq 0,\ \text{point light at } (\frac{x}{w}, \frac{y}{w}, \frac{z}{w})^t \\ w = 0,\ \text{directional light to } (-x,\ -y,\ -z)^t\end{cases}$
- $\overrightarrow{VP}_{pli}$:
	- 꼭짓점에서 광원으로의 방향에 대하여 길이가 1인 단위 벡터
- $n \odot\overrightarrow{VP}_{pli}$:
	- 양수일 경우에만 반사 값을 취하고, 그 이외의 경우(빛이 뒤에서 들어오는 경우)에는 0 값을 취한다.

3. specular reflection $(f_i)(n\odot\hat{h_i})^{s_{rm}}s_{cm} * s_{cli}$
- $\hat{h_i}= \frac{L+V}{|L+V|}$:
	$\begin{cases} \overrightarrow{VP}_{pli} + \overrightarrow{VP}_{e},\ v_{bs} = TRUE \\ \overrightarrow{VP}_{pli} + (0\ 0\ 1\ 0)^t,\ v_{bs} = FALSE \end{cases}$
	- $V$ 벡터(관찰자 방향 벡터)로 무엇이 쓰일지는 관찰자의 종류에 따라 달라진다.
- $f_i$:
	- 0 또는 1 값을 가지며, diffuse reflection과 마찬가지로 $n \odot\overrightarrow{VP}_{pli}$ 값이 양수일 경우에만 반사 값을 취하고, 그 이외의 경우(빛이 뒤에서 들어오는 경우)에는 0 값을 취한다.

$$\begin{align}
(att_i)(spot_i)[a_{cm} * a_{cli} + (n \odot\overrightarrow{VP}_{pli})d_{cm} * d_{cli} + (f_i)(n\odot\hat{h_i})^{s_{rm}}s_{cm} * s_{cli}]
\end{align}$$
- $att_i$:
	$\begin{cases}\frac{1}{k_{0i}+k_{1i}||VP_{pli}||+k_{2i}||VP_{pli}||^2},\ P_{pli}'s\ w \neq 0 \text{ (point light)} \\ 1.0,\ P_{pli}'s\ w = 0 \text{ (directional light)}\end{cases}$
	- 빛의 감쇠를 위한 인자로, 평행 광원의 경우는 무시하고 계산을 진행한다.
	- OpenGL에서 빛의 감쇠 효과는 default가 아니다.
- $spot_i$:
	$\begin{cases}(\overrightarrow{P_{pli}V}\odot\hat{s_{dli}})^{s_{rli}},\ c_{rli} \neq 180.0\ \& \ \overrightarrow{P_{pli}V}\odot\hat{s_{dli}} \geq \cos{c_{rli}} \\ 0.0,\ c_{rli} \neq 180.0\ \& \ \overrightarrow{P_{pli}V}\odot\hat{s_{dli}} < \cos{c_{rli}} \\ 1.0,\ c_{rli} = 180.0\end{cases}$
	- 스폿 조명이라는 가정 하에서($c_{rli}\neq180.0$), $\cos{\psi}$와 $\cos{c_{rli}}$의 값을 비교하여 클립 범위 안팎 여부에 따라 값이 바뀐다.
	- $(\overrightarrow{P_{pli}V}\odot\hat{s_{dli}})^{s_{rli}}=\cos^{s_{rli}}{\psi}$(정반사 공식 상기)로 어두워지는 정도를 계산할 때 스폿 광원 지수 $s_{rli}$가 쓰인다.

$$\begin{align}
c &= e_{cm} + a_{cm} * a_{cs} + \\
& \sum\limits_{i=0}^{n-1}(att_i)(spot_i)[a_{cm} * a_{cli} + (n \odot\overrightarrow{VP}_{pli})d_{cm} * d_{cli} + (f_i)(n\odot\hat{h_i})^{s_{rm}}s_{cm} * s_{cli}]
\end{align}$$
- $e_{cm} + a_{cm} * a_{cs}$:
	- global ambient reflection과 물질의 방사 색깔 계산